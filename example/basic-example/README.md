# Модуль java-sdk-basic-example

Содержит примеры использования разных компонент и CLI для работы с SDK

## Описание и применение CLI

Для быстрого старта работы с API в модуль basic-example была добавлена возможность взаимодействия с SDK через
CLI (Command Line Interface).

Приведём конкретные примеры работы.

### Начало работы

Чтобы работать с CLI Вам необходимо наличие установленной Java не ниже 17 версии.
Итак, скачать jar-файл для запуска CLI можно скачать по ссылке из
[maven repository](https://repo1.maven.org/maven2/ru/tinkoff/piapi/java-sdk-basic-example/1.40/java-sdk-basic-example-1.40.jar).
Для запуска нужно обязательно указать файл настроек с помощью флага `-p`. Почитать подробнее об его содержании можно на
странице модуля [core](../../core/README.md#конфигурация-клиента).
Подробнее об опциях каждой подкоманды можно узнать с помощью флага `-h`.

### Получение акции по тикеру

Найдём акции с тикером VTBR:

```shell
java -jar java-sdk-basic-example-1.40.jar -p invest.properties client instruments -t VTBR shares
```

В консоли увидим, что результат записан в файл `output.json`. Нас интересует уникальный идентификатор инструмента - UID.
Он позволит нам дальше однозначно указывать инструмент в запросах для корректной работы с API. Находим строчку с uid в
файле output.json:

```json
{
  "instruments": [
    {
      "figi": "BBG004730ZJ9",
      "ticker": "VTBR",
      ...
      "name": "Банк ВТБ",
      ...
      "tradingStatus": "SECURITY_TRADING_STATUS_DEALER_NORMAL_TRADING",
      "buyAvailableFlag": true,
      "sellAvailableFlag": true,
      ...
      "apiTradeAvailableFlag": true,
      "uid": "8e2b0325-0292-4654-8a18-4f63ed3b0e09",
      ...
    }
  ]
}
```

По описанным выше полям видим, что это действительно тот инструмент, который мы искали.

> **Примечание**
> <br>Может быть и такое, что по одному тикеру найдётся несколько инструментов. Такое случается, когда с бумагой
> происходят какие-либо корпоративные действия, например, изменение лотности и вам возвращаются старый и новый
> инструменты.
> В таких случаях проверяйте актуальность инструмента.</br>

### Получение исторических свечных данных по инструменту

У нас есть UID инструмента и теперь мы можем полноценно работать с CLI. Давайте получим свечные данные по акции Банк ВТБ
с 1 января 2019 года:

```shell
java -jar java-sdk-basic-example-1.40.jar -p invest.properties history-bars -i 8e2b0325-0292-4654-8a18-4f63ed3b0e09
--candle-interval CANDLE_INTERVAL_1_MIN --start-date 2019-01-01
```

Можно указать и иной интервал свечи. Чтобы увидеть все доступные интервалы достаточно вызвать CLI с
опцией `-h` (`--help`):

```shell
java -jar java-sdk-basic-example-1.40.jar -p invest.properties history-bars -h
```

В текущей директории у нас появится файл `8e2b0325-0292-4654-8a18-4f63ed3b0e09_candle_interval_1_min.csv` с содержимым
вида:

```csv
start_time,open,high,low,close,volume
2019-01-03T07:00:00Z,0.03391,0.03391,0.033705,0.03376,12764
2019-01-03T07:01:00Z,0.03379,0.033845,0.033785,0.033825,2629
...
```

Дальше эти данные Вы можете использовать для своих задач по анализу рынка.

### Бектест стратегии cross-EMA на инструменте

Имея найденный ранее UID инструмента, мы можем провести бектест стратегии cross-EMA и найти лучшие параметры для неё.
Для этого нужно запустить следующую команду:

```shell
java -jar java-sdk-basic-example-1.40.jar -p invest.properties backtest -i 8e2b0325-0292-4654-8a18-4f63ed3b0e09
--candle-interval CANDLE_INTERVAL_30_MIN --start-date 2024-01-01 --end-date 2025-03-20
```

После завершения работы программы в терминале вы увидите отчёт по самой прибыльной стратегии и её параметры.
Нам интрересна именно строчка с параметрами:

```
...
[main] INFO  r.t.p.e.s.b.ChooseBestStrategyExample - Strategy: shortEma=11, longEma=10
...
```

Запомним эти параметры, они пригодятся в следующем шаге.

### Запуск стратегии с подобранными параметрами

Теперь нужно запустить бота, который будет торговать по стратегии cross-EMA с подобранными ранее параметрами.
Для этого изменим параметр `sandbox.enabled` в файле `invest.properties` на `true` и запустим стратегию через CLI:

```shell
java -jar java-sdk-basic-example-1.40.jar -p invest.properties -i 8e2b0325-0292-4654-8a18-4f63ed3b0e09
--candle-interval CANDLE_INTERVAL_30_MIN --short-ema 11 --long-ema 10
```

Если захотите перейти на реальный рынок, то достаточно перезапустить бота с параметром `sandbox.enabled` равным `false`.

